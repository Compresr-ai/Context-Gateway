# =============================================================================
# Context Gateway - Fast Setup Configuration
# =============================================================================
# All optimizations enabled out-of-the-box:
#   - Preemptive Summarization (Lingua) - Proactively summarizes history
#   - Tool Output Compression (GemFilter) - Compresses large tool outputs
#   - Tool Discovery (SaT) - Filters irrelevant tools from context
#
# This is the recommended configuration for new users.
# =============================================================================

metadata:
  name: "Fast Setup"
  description: "All optimizations enabled - best performance"
  strategy: "full"

server:
  port: ${GATEWAY_PORT:-18080}
  read_timeout: 30s
  write_timeout: 1000s

urls:
  gateway: "http://localhost:${GATEWAY_PORT:-18080}"
  compresr: "${COMPRESR_BASE_URL:-https://api.compresr.ai}"

# =============================================================================
# PROVIDERS
# =============================================================================

providers:
  anthropic:
    api_key: "${ANTHROPIC_API_KEY:-}"
    model: "claude-haiku-4-5"

  openai:
    auth: "oauth"
    model: "gpt-4o-mini"

# =============================================================================
# PREEMPTIVE SUMMARIZATION (Lingua via Compresr API)
# =============================================================================

preemptive:
  enabled: true
  trigger_threshold: 85.0
  add_response_headers: true

  log_dir: "${SESSION_DIR:-logs}"
  compaction_log_path: "${SESSION_COMPACTION_LOG:-logs/history_compaction.jsonl}"

  summarizer:
    strategy: "compresr"
    max_tokens: 4096
    timeout: 60s
    token_estimate_ratio: 4
    compresr:
      endpoint: "/api/compress/history/"
      api_key: "${COMPRESR_API_KEY:-}"
      model: "hcc_espresso_v1"
      timeout: 60s

  session:
    summary_ttl: 3h
    hash_message_count: 3

# =============================================================================
# COMPRESSION PIPES (All Enabled)
# =============================================================================

pipes:
  # Tool Output Compression - GemFilter backbone
  tool_output:
    enabled: true
    strategy: "compresr"
    min_bytes: 2048
    compresr:
      endpoint: "/api/compress/tool-output/"
      api_key: "${COMPRESR_API_KEY:-}"
      model: "toc_latte_v1"
      timeout: 30s
  
  # Tool Discovery - SaT backbone
  tool_discovery:
    enabled: true
    strategy: "compresr"
    min_tools: 5
    max_tools: 25
    target_ratio: 0.8
    compresr:
      endpoint: "/api/compress/tool-discovery/"
      api_key: "${COMPRESR_API_KEY:-}"
      model: "tdc_coldbrew_v1"
      timeout: 20s

# =============================================================================
# COST CONTROL
# =============================================================================

cost_control:
  enabled: false
  session_cap: 0  # No session limit
  global_cap: 0

# =============================================================================
# SLACK NOTIFICATIONS (Disabled)
# =============================================================================

slack:
  enabled: false

# =============================================================================
# STORE
# =============================================================================

store:
  type: "memory"
  ttl: 1h

# =============================================================================
# MONITORING
# =============================================================================

monitoring:
  log_level: "off"
  log_format: "console"
  log_output: "stdout"
  telemetry_enabled: true
  verbose_payloads: false
  telemetry_path: "${SESSION_TELEMETRY_LOG:-logs/telemetry.jsonl}"
  compression_log_path: "${SESSION_COMPRESSION_LOG:-logs/tool_output_compression.jsonl}"
  tool_discovery_log_path: "${SESSION_TOOL_DISCOVERY_LOG:-logs/tool_discovery.jsonl}"

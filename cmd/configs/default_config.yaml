# =============================================================================
# Context Gateway - Default Configuration
# =============================================================================
# Simplified configuration with dual-model support:
#   - Lingua: Semantic summarization (preemptive)
#   - GemFilter: Tool output compression (attention-based, query-specific)
#   - SaT: Tool discovery
#
# This is the recommended production configuration.
# Last updated: February 2026
# =============================================================================

metadata:
  name: "Default Configuration"
  description: "Lingua for summarization, GemFilter for tool compression, SaT for tool discovery"
  strategy: "hybrid"

server:
  port: ${GATEWAY_PORT:-18080}
  read_timeout: 30s
  write_timeout: 1000s

urls:
  gateway: "http://localhost:${GATEWAY_PORT:-18080}"
  compresr: "${COMPRESR_BASE_URL:-https://api.compresr.ai}"

# =============================================================================
# PROVIDERS - Single provider per use case
# =============================================================================
# Provider names can be arbitrary, but using standard names (anthropic, openai)
# ensures proper auth handler mapping for subscription/OAuth fallback.

providers:
  # Anthropic for semantic summarization
  anthropic:
    api_key: "${ANTHROPIC_API_KEY:-}"
    model: "claude-haiku-4-5"
  
  # OpenAI support
  openai:
    auth: "oauth"
    model: "gpt-4o-mini"
  
  # Alias for backward compatibility
  semantic_summarization:
    api_key: "${ANTHROPIC_API_KEY:-}"
    model: "claude-haiku-4-5"

# =============================================================================
# PREEMPTIVE SUMMARIZATION (Lingua)
# =============================================================================

preemptive:
  enabled: true
  trigger_threshold: 85.0
  add_response_headers: true
  
  log_dir: "${SESSION_DIR:-logs}"
  compaction_log_path: "${SESSION_COMPACTION_LOG:-logs/history_compaction.jsonl}"
  
  summarizer:
    # Strategy: "provider" (LLM) or "api" (Compresr API)
    strategy: "provider"
    
    # For strategy: "provider" (LLM-based summarization)
    provider: "semantic_summarization"
    max_tokens: 4096
    timeout: 60s
    token_estimate_ratio: 4
    
    # For strategy: "api" (Compresr API-based compression)
    # Uncomment to use Compresr API instead of LLM
    # strategy: "api"
    # api:
    #   endpoint: "https://api.compresr.ai/api/compress/history/"
    #   api_key: "${COMPRESR_API_KEY:-}"
    #   model: "hcc_espresso_v1"
    #   timeout: 30s
  
  session:
    summary_ttl: 3h
    hash_message_count: 3

# =============================================================================
# COMPRESSION PIPES (Compresr API)
# =============================================================================

pipes:
  # Tool Output Compression - uses GemFilter backbone (attention-based, query-specific)
  tool_output:
    enabled: true
    strategy: "api"
    min_bytes: 2048
    api:
      endpoint: "/api/compress/tool-output/"
      api_key: "${COMPRESR_API_KEY:-}"
      model: "toc_latte_v1"
      timeout: 30s
  
  # Tool Discovery - uses SaT backbone (disabled by default to prevent tool schema corruption)
  tool_discovery:
    enabled: false
    strategy: "api"
    min_tools: 5
    max_tools: 25
    target_ratio: 0.8
    api:
      endpoint: "/api/compress/tool-discovery/"
      api_key: "${COMPRESR_API_KEY:-}"
      model: "tdc_coldbrew_v1"
      timeout: 20s

# =============================================================================
# COST CONTROL
# =============================================================================

cost_control:
  enabled: false
  session_cap: 0
  global_cap: 0

# =============================================================================
# STORE
# =============================================================================

store:
  type: "memory"
  ttl: 1h

# =============================================================================
# MONITORING
# =============================================================================

monitoring:
  log_level: "off"
  log_format: "console"
  log_output: "stdout"
  telemetry_enabled: true
  verbose_payloads: false
  telemetry_path: "${SESSION_TELEMETRY_LOG:-logs/telemetry.jsonl}"
  compression_log_path: "${SESSION_COMPRESSION_LOG:-logs/tool_output_compression.jsonl}"
  tool_discovery_log_path: "${SESSION_TOOL_DISCOVERY_LOG:-logs/tool_discovery.jsonl}"
